# Guía de Pentesting - CryptoMessenger

Esta guía está diseñada para tu colega que realizará las pruebas de penetración.

## 1. Entorno de Pruebas

### Configuración
```bash
# Backend
cd backend
python manage.py runserver 0.0.0.0:8000

# Frontend
cd frontend
npm run dev
```

### URLs
- **Frontend**: http://localhost:5173
- **Backend API**: http://localhost:8000/api/
- **Admin Django**: http://localhost:8000/admin/

---

## 2. Endpoints a Probar

### Autenticación

| Endpoint | Método | Auth | Pruebas sugeridas |
|----------|--------|------|-------------------|
| `/api/auth/register/` | POST | No | Contraseñas débiles, inyección |
| `/api/auth/login/` | POST | No | Fuerza bruta, timing attack |
| `/api/auth/me/` | GET | JWT | Token manipulation |
| `/api/auth/me/keys/` | GET | JWT | Acceso no autorizado |

### Criptografía

| Endpoint | Método | Auth | Pruebas sugeridas |
|----------|--------|------|-------------------|
| `/api/crypto/keys/generate/` | POST | No | Key sizes inválidos |
| `/api/crypto/aes/encrypt/` | POST | No | IV reuse, padding oracle |
| `/api/crypto/aes/decrypt/` | POST | No | Datos malformados |
| `/api/crypto/rsa/encrypt/` | POST | No | Claves débiles |
| `/api/crypto/rsa/sign/` | POST | No | Signature malleability |

### Mensajería

| Endpoint | Método | Auth | Pruebas sugeridas |
|----------|--------|------|-------------------|
| `/api/messages/` | GET | JWT | IDOR |
| `/api/messages/send/` | POST | JWT | Message tampering |
| `/api/messages/{id}/` | GET | JWT | Acceso a mensajes de otros |
| `/api/messages/{id}/decrypt/` | POST | JWT | Sin autorización |

---

## 3. Categorías de Pruebas

### 3.1 Autenticación y Sesiones
- [ ] Fuerza bruta en login (verificar bloqueo después de 5 intentos)
- [ ] Enumeración de usuarios
- [ ] JWT token expiration
- [ ] Token reuse después de logout
- [ ] Bypass de autenticación

### 3.2 Autorización
- [ ] IDOR en mensajes (`/api/messages/{id}/`)
- [ ] Acceso a claves privadas de otros usuarios
- [ ] Escalación de privilegios a admin

### 3.3 Criptografía
- [ ] Reutilización de IV
- [ ] Claves débiles
- [ ] Padding oracle attacks
- [ ] Verificar aleatoriedad de claves generadas

### 3.4 Inyección
- [ ] SQL injection en búsquedas
- [ ] XSS en mensajes
- [ ] Command injection

### 3.5 Rate Limiting
- [ ] Bypass de throttling
- [ ] DoS por requests excesivos

---

## 4. Herramientas Recomendadas

| Herramienta | Uso |
|-------------|-----|
| **Burp Suite** | Interceptar y modificar requests |
| **OWASP ZAP** | Escaneo automatizado |
| **Postman** | Pruebas manuales de API |
| **Hydra** | Fuerza bruta |
| **sqlmap** | Detección de SQL injection |

---

## 5. Payloads de Ejemplo

### SQL Injection
```json
{
  "username": "admin' OR '1'='1",
  "password": "test"
}
```

### JWT Manipulation
1. Decodificar token: https://jwt.io
2. Modificar claims
3. Cambiar algoritmo a "none"

### Fuerza Bruta
```bash
hydra -l admin -P wordlist.txt localhost http-post-form "/api/auth/login/:username=^USER^&password=^PASS^:invalid"
```

---

## 6. Reporte

Para cada vulnerabilidad encontrada, documentar:

1. **Descripción**: Qué es la vulnerabilidad
2. **Impacto**: Qué daño puede causar
3. **Pasos para reproducir**: Cómo explotarla
4. **Evidencia**: Screenshots, logs
5. **Recomendación**: Cómo arreglarla
6. **Severidad**: Crítica/Alta/Media/Baja

---

## 7. Contacto

Si encuentras una vulnerabilidad crítica, notificar inmediatamente a:
- [Tu correo/contacto]
